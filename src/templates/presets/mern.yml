version: '1.0'
metadata:
  name: mern-dev
  description: MERN stack with MongoDB Atlas
  author: repdev
  created_at: 2025-10-20

# CUSTOMIZATION GUIDE:
# When you run 'repdev init -p mern', you'll be prompted to customize:
# - Backend/Frontend directories (if not ./backend and ./frontend)
# - Ports (if not 3000 for backend, 5173 for frontend)
# - Package manager (npm, yarn, or pnpm)
#
# You can also manually edit this file:
# - Update volume paths: ./backend:/app â†’ ./server:/app
# - Update ports: "3000:3000" â†’ "4000:4000"
# - Update env vars: MONGO_URI, JWT_SECRET, etc.
# - Change network_mode: add 'network_mode: host' to services if needed

hooks:
  preUp:
    - echo "ðŸš€ Starting MERN environment..."
  postUp:
    - echo "âœ… Environment ready!"
    - 'echo "ðŸ“± Frontend: http://localhost:5173"'
    - 'echo "ðŸ”§ Backend: http://localhost:3000"'
  preDown:
    - echo "ðŸ§¹ Stopping containers..."
  postDown:
    - echo "âœ… Cleanup finished."

services:
  backend:
    image: node:20
    container_name: mern_backend
    working_dir: /app
    volumes:
      - ./backend:/app  # Customize: Change to ./server or your backend folder
    ports:
      - "3000:3000"     # Customize: Change if your backend uses different port
    env_file:
      - ./backend/.env
      # Loads environment from backend/.env file
      # Create this file with: DB_URI, JWT_SECRET, API_KEYS, etc.
    environment:
      NODE_ENV: development
      PORT: 3000
      # Inline environment vars override env_file
      # Remove hardcoded secrets and move to .env file!
    command: 
      - sh
      - -c
      - |
        if [ ! -d "node_modules" ]; then
          echo "ðŸ“¦ Installing backend dependencies..."
          npm install
        fi
        echo "ðŸ”§ Starting backend server..."
        npm run start
    hooks:
      afterStart:
        - echo "âœ… Backend running on http://localhost:3000"

  frontend:
    image: node:20
    container_name: mern_frontend
    working_dir: /app
    volumes:
      - ./frontend:/app
    ports:
      - "5173:5173"
    environment:
      NODE_ENV: development
      VITE_SERVER_URL: http://localhost:3000
    command:
      - sh
      - -c
      - |
        rm -rf node_modules package-lock.json
        echo "ðŸ“¦ Installing frontend dependencies..."
        npm install
        echo "ðŸ“± Starting Vite dev server..."
        npm run dev -- --host 0.0.0.0
    depends_on:
      - backend
    hooks:
      afterStart:
        - echo "âœ… Frontend running on http://localhost:5173"

# Notes:
# 1. Dependencies auto-install on first run
# 2. Use --no-wait flag if wait_for times out (services need time to start)
# 3. Environment variables are inline (move sensitive ones to .env in production)
# 4. Backend uses 'npm run start' (your actual script name)
# 5. Frontend uses 'npm run dev -- --host 0.0.0.0' to bind to all interfaces
